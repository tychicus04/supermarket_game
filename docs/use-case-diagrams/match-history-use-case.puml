@startuml Match_History_Use_Case
!theme plain
skinparam backgroundColor #FFFFFF
skinparam actorStyle awesome

title Use Case Diagram - Match History (L·ªãch S·ª≠ ƒê·∫•u)

left to right direction

' Actors
actor "Player\n(Ng∆∞·ªùi ch∆°i)" as Player
actor "System\n(H·ªá th·ªëng)" as System
actor "Database\n(C∆° s·ªü d·ªØ li·ªáu)" as Database

' Package for Match History
rectangle "Match History System" {
    ' Player Use Cases
    package "Player Functions\n(Ch·ª©c nƒÉng ng∆∞·ªùi ch∆°i)" {
        usecase "View Match History\n(Xem l·ªãch s·ª≠ ƒë·∫•u)" as UC1
        usecase "View Match Statistics\n(Xem th·ªëng k√™)" as UC2
        usecase "View Win Rate\n(Xem t·ª∑ l·ªá th·∫Øng)" as UC3
        usecase "View Match Details\n(Xem chi ti·∫øt tr·∫≠n ƒë·∫•u)" as UC4
        usecase "Filter by Result\n(L·ªçc theo k·∫øt qu·∫£)" as UC5
        usecase "Check Opponent Info\n(Xem th√¥ng tin ƒë·ªëi th·ªß)" as UC6
    }

    ' System Data Retrieval
    package "Data Retrieval\n(L·∫•y d·ªØ li·ªáu)" {
        usecase "Fetch Match History\n(L·∫•y l·ªãch s·ª≠ ƒë·∫•u)" as UC7
        usecase "Fetch Match Stats\n(L·∫•y th·ªëng k√™)" as UC8
        usecase "Load Recent Matches\n(T·∫£i c√°c tr·∫≠n g·∫ßn ƒë√¢y)" as UC9
        usecase "Calculate Win Rate\n(T√≠nh t·ª∑ l·ªá th·∫Øng)" as UC10
    }

    ' System Processing
    package "Data Processing\n(X·ª≠ l√Ω d·ªØ li·ªáu)" {
        usecase "Format Match Data\n(ƒê·ªãnh d·∫°ng d·ªØ li·ªáu)" as UC11
        usecase "Determine Match Result\n(X√°c ƒë·ªãnh k·∫øt qu·∫£)" as UC12
        usecase "Sort by Date\n(S·∫Øp x·∫øp theo ng√†y)" as UC13
        usecase "Count Wins/Losses/Draws\n(ƒê·∫øm th·∫Øng/thua/h√≤a)" as UC14
    }

    ' Database Operations
    package "Database Operations\n(Thao t√°c c∆° s·ªü d·ªØ li·ªáu)" {
        usecase "Query Match History Table\n(Truy v·∫•n b·∫£ng l·ªãch s·ª≠)" as UC15
        usecase "Save Match Result\n(L∆∞u k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u)" as UC16
        usecase "Filter Player Matches\n(L·ªçc tr·∫≠n c·ªßa ng∆∞·ªùi ch∆°i)" as UC17
        usecase "Aggregate Statistics\n(T·ªïng h·ª£p th·ªëng k√™)" as UC18
        usecase "Limit to 20 Records\n(Gi·ªõi h·∫°n 20 b·∫£n ghi)" as UC19
    }

    ' Display Features
    package "Display Features\n(T√≠nh nƒÉng hi·ªÉn th·ªã)" {
        usecase "Display Match Entries\n(Hi·ªÉn th·ªã c√°c tr·∫≠n)" as UC20
        usecase "Show Result Icons\n(Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng k·∫øt qu·∫£)" as UC21
        usecase "Display Scores\n(Hi·ªÉn th·ªã ƒëi·ªÉm)" as UC22
        usecase "Show Timestamps\n(Hi·ªÉn th·ªã th·ªùi gian)" as UC23
        usecase "Show Statistics Panel\n(Hi·ªÉn th·ªã b·∫£ng th·ªëng k√™)" as UC24
        usecase "Show Loading State\n(Hi·ªÉn th·ªã tr·∫°ng th√°i t·∫£i)" as UC25
        usecase "Handle No Matches\n(X·ª≠ l√Ω kh√¥ng c√≥ tr·∫≠n)" as UC26
    }

    ' Match Recording (triggered by game end)
    package "Match Recording\n(Ghi nh·∫≠n tr·∫≠n ƒë·∫•u)" {
        usecase "Record Match\n(Ghi nh·∫≠n tr·∫≠n)" as UC27
        usecase "Store Player Scores\n(L∆∞u ƒëi·ªÉm s·ªë)" as UC28
        usecase "Store Opponent\n(L∆∞u ƒë·ªëi th·ªß)" as UC29
        usecase "Store Timestamp\n(L∆∞u th·ªùi gian)" as UC30
        usecase "Determine Winner\n(X√°c ƒë·ªãnh ng∆∞·ªùi th·∫Øng)" as UC31
    }
}

' Player relationships
Player --> UC1 : requests
Player --> UC2 : views
Player --> UC3 : checks
Player --> UC4 : examines
Player --> UC5 : filters
Player --> UC6 : looks up

' System relationships
System --> UC7 : executes
System --> UC8 : executes
System --> UC9 : loads
System --> UC10 : calculates
System --> UC11 : formats
System --> UC12 : determines
System --> UC13 : sorts
System --> UC14 : counts
System --> UC27 : triggers
System --> UC28 : stores
System --> UC29 : stores
System --> UC30 : stores
System --> UC31 : calculates

' Database relationships
Database --> UC15 : queries
Database --> UC16 : inserts
Database --> UC17 : filters
Database --> UC18 : aggregates
Database --> UC19 : limits

' Include relationships - Player View Flow
UC1 ..> UC7 : <<include>>
UC1 ..> UC8 : <<include>>
UC1 ..> UC25 : <<include>>
UC2 ..> UC8 : <<include>>
UC2 ..> UC10 : <<include>>
UC2 ..> UC14 : <<include>>
UC4 ..> UC11 : <<include>>
UC4 ..> UC22 : <<include>>
UC4 ..> UC23 : <<include>>

' Include relationships - Data Retrieval
UC7 ..> UC15 : <<include>>
UC7 ..> UC9 : <<include>>
UC8 ..> UC18 : <<include>>
UC9 ..> UC17 : <<include>>
UC9 ..> UC19 : <<include>>
UC9 ..> UC13 : <<include>>

' Include relationships - Display
UC1 ..> UC20 : <<include>>
UC20 ..> UC21 : <<include>>
UC20 ..> UC22 : <<include>>
UC20 ..> UC23 : <<include>>
UC2 ..> UC24 : <<include>>

' Include relationships - Match Recording
UC27 ..> UC16 : <<include>>
UC27 ..> UC28 : <<include>>
UC27 ..> UC29 : <<include>>
UC27 ..> UC30 : <<include>>
UC27 ..> UC31 : <<include>>

' Extend relationships
UC26 ..> UC1 : <<extend>>\n(if no matches)
UC3 ..> UC2 : <<extend>>\n(part of stats)
UC5 ..> UC4 : <<extend>>\n(visual filtering)
UC6 ..> UC4 : <<extend>>\n(opponent details)

' Dependencies
UC7 ..> UC11 : produces data for
UC8 ..> UC24 : feeds
UC11 ..> UC12 : uses
UC14 ..> UC10 : enables
UC12 ..> UC21 : determines

' Notes
note right of UC9
  Loads up to 20
  most recent matches
end note

note right of UC12
  Result Logic:
  - Winner = player ‚Üí WIN
  - Winner = null ‚Üí DRAW
  - Winner = opponent ‚Üí LOSE
end note

note bottom of UC10
  Formula:
  Win Rate = (Wins / Total) √ó 100%
end note

note left of UC21
  Icons:
  üèÜ WIN (green border)
  üíî LOSE (red border)
  ü§ù DRAW (gray border)
end note

note right of UC27
  Automatically triggered
  when multiplayer
  game ends
end note

note bottom of UC15
  Query filters:
  WHERE player1 = username
  OR player2 = username
  ORDER BY played_at DESC
  LIMIT 20
end note

note right of UC18
  Statistics SQL:
  - COUNT wins (winner = user)
  - COUNT losses (winner != user AND winner IS NOT NULL)
  - COUNT draws (winner IS NULL)
end note

note top of UC24
  Displays:
  - Wins (green)
  - Losses (red)
  - Draws (gray)
  - Win Rate % (blue)
end note

@enduml
